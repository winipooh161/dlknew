import{f as q,a as j,r as I}from"./chat-utils-BxoIr4m-.js";import"./notification-BNuqCmH2.js";function A(c){const u=c.parentElement;getComputedStyle(u).position==="static"&&(u.style.position="relative");const d=document.createElement("button"),i=document.createElement("div");d.textContent="üòâ",d.type="button",d.classList.add("emoji-button"),i.classList.add("emoji-picker"),i.style.position="absolute",i.style.bottom="50px",i.style.left="10px",i.style.zIndex="1000";const v=["üòÄ","üòÅ","üòÇ","ü§£","üòÉ","üòÑ","üòÖ","üòÜ","üòâ","üòä","üòç","üòò","üòú","üòé","üò≠","üò°","üòá","üòà","üôÉ","ü§î","üò•","üòì","ü§©","ü•≥","ü§Ø","ü§¨","ü§°","üëª","üíÄ","üëΩ","ü§ñ","üéÉ","üê±","üê∂","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","ü¶Å","üêÆ","üê∑","üê∏","üêµ","üêî","üêß","üê¶","üåπ","üåª","üå∫","üå∑","üåº","üçé","üçì","üçí","üçá","üçâ","üçã","üçä","üçå","ü•ù","üçç","ü•≠"];let C="";v.forEach(l=>{C+=`<span class="emoji-item">${l}</span>`}),i.innerHTML=C,i.addEventListener("click",l=>{if(l.target.classList.contains("emoji-item")){const w=l.target.textContent,m=c.selectionStart,p=c.value.substring(0,m),h=c.value.substring(m);c.value=p+w+h;const f=m+w.length;c.selectionStart=f,c.selectionEnd=f,c.focus()}}),u.appendChild(d),u.appendChild(i),i.style.display="none",d.addEventListener("click",l=>{l.stopPropagation(),i.style.display=i.style.display==="none"?"flex":"none"}),document.addEventListener("click",l=>{!i.contains(l.target)&&!d.contains(l.target)&&(i.style.display="none")})}document.addEventListener("DOMContentLoaded",()=>{var T,S,k;let c=document.querySelector(".chat-container")||document.getElementById("chat-container");!c||!c.dataset.chatId||!c.dataset.chatType?(console.warn("Chat container –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–∞—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é."),window.currentChatId="0",window.currentChatType="group"):(window.currentChatId=c.dataset.chatId,window.currentChatType=c.dataset.chatType),(S=(T=window.Laravel)==null?void 0:T.user)==null||S.id;const u=(k=document.querySelector('meta[name="csrf-token"]'))==null?void 0:k.getAttribute("content");let d=new Set;window.loadedMessageIds=d,window.lastLoadedMessageId=0,window.fetchNewMessages=q;function i(e){if(!window.firestore)return;const n=window.firestore.collection?window.firestore.collection(`chats/${e}/messages`):null;if(!n)return;n.orderBy("created_at").onSnapshot(o=>{let t=[];o.docChanges().forEach(s=>{if(s.type==="added"){const a=s.doc.data();d.has(a.id)||t.push(a)}}),t.length>0&&(I(t,window.Laravel.user.id,d,u,currentChatType,currentChatId),w(currentChatId,currentChatType))},o=>{console.error("–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ Firestore –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:",o)})}async function v(e,n){window.currentChatId=e,window.currentChatType=n,window.lastLoadedMessageId=0;const o=document.getElementById("chat-messages").querySelector("ul");o.innerHTML="",d.clear();const t=document.querySelector(`[data-chat-id="${e}"][data-chat-type="${n}"] h5`);document.getElementById("chat-header").textContent=t?t.textContent:"–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è";try{const s=await fetch(`/chats/${n}/${e}/messages`);if(!s.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–æ–±—â–µ–Ω–∏–π.");const a=await s.json();a.error?m(a.error):(a.messages&&a.messages.length>0&&(window.lastLoadedMessageId=a.messages[a.messages.length-1].id,I(a.messages,window.Laravel.user.id,d,u,n,e)),await w(e,n),i(e),q())}catch(s){m("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π: "+s.message),console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:",s)}}(()=>{const e=document.querySelectorAll(".attach-file"),n=document.querySelectorAll(".file-input");e.forEach((r,o)=>{n[o]&&(r.addEventListener("click",()=>{n[o].click()}),n[o].addEventListener("change",t=>{const s=t.target.files;if(s.length>0){let a=Array.from(s).map(E=>E.name).join(", ");console.log("–í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:",a);const b=r.closest(".chat-input");let g=b.querySelector(".file-preview");g||(g=document.createElement("div"),g.classList.add("file-preview"),b.insertBefore(g,f)),g.innerHTML="",Array.from(s).forEach(E=>{const M=document.createElement("div");M.classList.add("file-item"),M.textContent=E.name,g.appendChild(M)})}}))})})();async function l(){if(!currentChatId||!f.value.trim()&&!document.querySelector(".file-input").files.length)return;h.disabled=!0;const e=f.value.trim(),r=document.querySelector(".file-input").files,o=new FormData;if(o.append("message",e),r&&r.length>0)for(let t=0;t<r.length;t++)o.append("attachments[]",r[t]);try{const t=await fetch(`/chats/${currentChatType}/${currentChatId}/messages`,{method:"POST",headers:{"X-CSRF-TOKEN":u},body:o});if(!t.ok){const a=await t.text();throw new Error(a)}const s=await t.json();if(s.message){I([s.message],s.message.sender_id,d,u,currentChatType,currentChatId),window.lastLoadedMessageId=s.message.id,f.value="",document.querySelector(".file-input").value="";const a=document.querySelector(".file-preview");a&&(a.innerHTML="",a.style.display="none")}else m(s.error||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è")}catch(t){m("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: "+t.message),console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:",t)}finally{h.disabled=!1}}function w(e,n){fetch(`/chats/${n}/${e}/mark-read`,{method:"POST",headers:{"X-CSRF-TOKEN":u}}).catch(r=>console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–º–µ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö:",r))}function m(e){console.log("Toast message:",e)}const p=document.getElementById("chat-list");p&&p.addEventListener("click",e=>{const n=e.target.closest("li");if(!n)return;const r=n.getAttribute("data-chat-id"),o=n.getAttribute("data-chat-type");if(!(currentChatId===r&&currentChatType===o)&&(v(r,o),window.innerWidth<=768)){const t=document.querySelector(".user-list"),s=document.querySelector(".chat-box");t&&s&&(t.classList.remove("active"),s.classList.add("active"),t.classList.add("inactive"),s.classList.add("active"))}});const h=document.getElementById("send-message"),f=document.getElementById("chat-message");A(f),h&&h.addEventListener("click",l),f&&f.addEventListener("keypress",e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),l())});const L=document.getElementById("toggle-pinned");let y=!1;L&&L.addEventListener("click",function(){y=!y,j(y),L.textContent=y?"–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è":"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ"});function B(){let e=setInterval(()=>{try{window.fetchNewMessages&&typeof window.fetchNewMessages=="function"&&window.fetchNewMessages()}catch(n){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —á–∞—Ç–∞:",n)}},1e3);window.chatUpdateTimer=e,window.fetchNewMessages&&window.fetchNewMessages()}B()});
