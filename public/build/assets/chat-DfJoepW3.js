import{r as f,f as q,c as B,a as A}from"./notification-pIEpekV4.js";import"./firebase-init-B7bxRSzu.js";import"./index.esm2017-VEW1WqW1.js";function P(d){const a=d.parentElement,r=document.createElement("button"),i=document.createElement("div");r.textContent="üòâ",r.type="button",r.classList.add("emoji-button"),i.classList.add("emoji-picker"),i.style.position="absolute",i.style.bottom="50px",i.style.left="10px";const h=["üòÄ","üòÅ","üòÇ","ü§£","üòÉ","üòÑ","üòÖ","üòÜ","üòâ","üòä","üòç","üòò","üòú","üòé","üò≠","üò°","üòá","üòà","üôÉ","ü§î","üò•","üòì","ü§©","ü•≥","ü§Ø","ü§¨","ü§°","üëª","üíÄ","üëΩ","ü§ñ","üéÉ","üê±","üê∂","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","ü¶Å","üêÆ","üê∑","üê∏","üêµ","üêî","üêß","üê¶","üåπ","üåª","üå∫","üå∑","üåº","üçé","üçì","üçí","üçá","üçâ","üçã","üçä","üçå","ü•ù","üçç","ü•≠"];let u="";h.forEach(l=>{u+=`<span class="emoji-item">${l}</span>`}),i.innerHTML=u,i.addEventListener("click",l=>{if(l.target.classList.contains("emoji-item")){const p=l.target.textContent,y=d.selectionStart,C=d.value.substring(0,y),E=d.value.substring(y);d.value=C+p+E;const m=y+p.length;d.selectionStart=m,d.selectionEnd=m,d.focus()}}),a.appendChild(r),a.appendChild(i),i.style.display="none",r.addEventListener("click",l=>{l.stopPropagation(),i.style.display=i.style.display==="none"?"flex":"none"}),document.addEventListener("click",l=>{!i.contains(l.target)&&!r.contains(l.target)&&(i.style.display="none")})}document.addEventListener("DOMContentLoaded",()=>{var k;const d=document.querySelector(".chat-container");let a=d?d.dataset.chatId:null,r=d?d.dataset.chatType:null;(!a||!r)&&console.error("–ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–∞—Ç–∞: currentChatId –∏–ª–∏ currentChatType –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã");const i=window.Laravel.user.id,h=document.querySelector('meta[name="csrf-token"]').getAttribute("content");let u=new Set,l=!1;async function p(s,t={}){try{const n=await fetch(s,t);if(!n.ok){const e=await n.text();throw new Error(`HTTP ${n.status}: ${e}`)}return await n.json()}catch(n){throw console.error("Fetch error:",n),n}}function y(s){if(!window.firestore)return;const t=window.firestore.collection?window.firestore.collection(`chats/${s}/messages`):null;if(!t){console.warn("Firestore –∫–æ–ª–ª–µ–∫—Ü–∏—è –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞");return}t.orderBy("created_at").onSnapshot(e=>{let o=[];e.docChanges().forEach(c=>{if(c.type==="added"){const b=c.doc.data();u.has(b.id)||o.push(b)}}),o.length>0&&(f(o,window.Laravel.user.id,u,h,r,a),m(a,r))},e=>{console.error("–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ Firestore –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:",e)})}function C(s,t){a=s,r=t;const e=document.getElementById("chat-messages").querySelector("ul");e.innerHTML="",u.clear();const o=document.querySelector(`[data-chat-id="${s}"][data-chat-type="${t}"] h5`);document.getElementById("chat-header").textContent=o?o.textContent:"–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è",p(`/chats/${t}/${s}/messages`).then(c=>{c.messages&&c.messages.length>0&&(window.lastLoadedMessageId=c.messages[c.messages.length-1].id),f(c.messages,i,u,h,r,a),m(s,t),j(s,t),y(s)}).catch(c=>console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:",c))}function E(){if(!a||!g.value.trim()&&!document.querySelector(".file-input").files[0])return;const s=g.value.trim(),n=document.querySelector(".file-input").files;let e=new FormData;e.append("message",s);for(let o=0;o<n.length;o++)e.append("attachments",n[o]);fetch(`/chats/${r}/${a}/messages`,{method:"POST",headers:{"X-CSRF-TOKEN":h},body:e}).then(o=>o.ok?o.json():o.text().then(c=>{throw new Error(c)})).then(o=>{o.message&&(f([o.message],o.message.sender_id,u,h,r,a),g.value="",document.querySelector(".file-input").value="")}).catch(o=>{console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:",o),alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: "+o.message)})}function m(s,t){fetch(`/chats/${t}/${s}/mark-read`,{method:"POST",headers:{"X-CSRF-TOKEN":h}}).catch(n=>console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–º–µ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö:",n))}function j(s,t){window.Echo&&(window.Echo.channel(`chat.${t}.${s}`).listen("MessageSent",n=>{console.log("–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≤–µ–±-—Å–æ–∫–µ—Ç:",n),u.has(n.message.id)||(f([n.message],i,u,h,r,a),m(s,t))}),window.Echo.connector.socket.on("error",n=>{console.error("WebSocket Error:",n)}),window.Echo.connector.socket.on("reconnect_attempt",()=>{console.log("–ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ WebSocket...")}))}setInterval(()=>{if(a&&r){const s=document.getElementById("chat-messages");if(!s||!s.querySelector("ul"))return;const n=window.lastLoadedMessageId||0;fetch(`/chats/${r}/${a}/new-messages`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":h},body:JSON.stringify({last_message_id:n})}).then(e=>{const o=e.headers.get("content-type");return o&&o.indexOf("application/json")!==-1?e.json():e.text().then(c=>{throw new Error(c)})}).then(e=>{if(e.messages&&e.messages.length>0){const o=e.messages[e.messages.length-1];window.lastLoadedMessageId=o.id,f(e.messages,e.current_user_id,u,h,r,a),m(a,r)}}).catch(e=>{console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:",e)})}},2e3),setInterval(()=>{a&&r&&fetch(`/chats/${r}/${a}/mark-delivered`,{method:"POST",headers:{"X-CSRF-TOKEN":h}}).catch(s=>console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:",s))},5e3);function O(s,t){let n;return function(...e){clearTimeout(n),n=setTimeout(()=>s.apply(this,e),t)}}const M=document.getElementById("chat-list");M&&M.addEventListener("click",s=>{const t=s.target.closest("li");if(!t)return;const n=t.getAttribute("data-chat-id"),e=t.getAttribute("data-chat-type");a===n&&r===e||C(n,e)});const S=document.getElementById("search-chats"),w=document.getElementById("search-results");S&&S.addEventListener("input",O(function(){const s=S.value.trim().toLowerCase();s===""?(w.style.display="none",Array.from(chatList.children).forEach(t=>{t.style.display="flex"})):(Array.from(chatList.children).forEach(t=>{const n=t.querySelector("h5").textContent.toLowerCase();t.style.display=n.includes(s)?"flex":"none"}),fetch("/chats/search",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":h},body:JSON.stringify({query:s})}).then(t=>t.json()).then(t=>{let n="";t.chats&&t.chats.length>0&&(n+="<h5>–ß–∞—Ç—ã</h5><ul>",t.chats.forEach(e=>{n+=`<li data-chat-id="${e.id}" data-chat-type="${e.type}">${e.name}</li>`}),n+="</ul>"),t.messages&&t.messages.length>0&&(n+="<h5>–°–æ–æ–±—â–µ–Ω–∏—è</h5><ul>",t.messages.forEach(e=>{let o=e.chat_id,c="group";o||(c="personal",o=e.sender_id==i?e.receiver_id:e.sender_id),n+=`<li data-chat-id="${o}" data-chat-type="${c}" data-message-id="${e.id}">
                                <strong>${e.sender_name}:</strong> ${e.message.substring(0,50)}...
                                <br><small>${A(e.created_at)}</small>
                            </li>`}),n+="</ul>"),w.innerHTML=n,w.style.display=n.trim()===""?"none":"block",Array.from(w.querySelectorAll("li")).forEach(e=>{e.addEventListener("click",function(){const o=this.getAttribute("data-chat-id"),c=this.getAttribute("data-chat-type"),b=this.getAttribute("data-message-id");C(o,c),S.value="",w.style.display="none",b&&setTimeout(()=>{},1e3)})})}).catch(t=>console.error("–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:",t)))},300));function I(){const s=document.querySelector(".attach-file"),t=document.querySelector(".file-input");s&&t&&(s.addEventListener("click",()=>{t.click()}),t.addEventListener("change",()=>{t.files.length>0&&E()}))}document.readyState!=="loading"?I():document.addEventListener("DOMContentLoaded",I);const T=document.getElementById("send-message"),g=document.getElementById("chat-message");T&&T.addEventListener("click",E),g&&g.addEventListener("keypress",s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),E())}),P(g);const $=(k=document.getElementById("chat-list"))==null?void 0:k.querySelector("li");$&&$.click();const v=document.getElementById("toggle-pinned");v&&v.addEventListener("click",()=>{l=!l,v.textContent=l?"–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è":"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ",q(l)}),B();const L=document.getElementById("chat-messages");if(L){const s=document.createElement("div");s.id="scroll-sentinel",L.appendChild(s),new IntersectionObserver(n=>{n.forEach(e=>{if(e.isIntersecting){const o=parseInt(L.getAttribute("data-page")||"1");a&&r?p(`/chats/${r}/${a}/messages?page=${o+1}`).then(c=>{c.messages&&c.messages.length>0&&(f(c.messages,i,u,h,r,a),L.setAttribute("data-page",o+1))}).catch(c=>console.error("–û—à–∏–±–∫–∞ –ø–æ–¥–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:",c)):console.warn("–ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–∞—Ç–∞: currentChatId –∏–ª–∏ currentChatType –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã")}})},{root:L,threshold:1}).observe(s)}});
