import{f as T,a as k,r as v}from"./chat-utils-BxoIr4m-.js";import"./notification-BNuqCmH2.js";function b(c){const u=c.parentElement;getComputedStyle(u).position==="static"&&(u.style.position="relative");const r=document.createElement("button"),i=document.createElement("div");r.textContent="üòâ",r.type="button",r.classList.add("emoji-button"),i.classList.add("emoji-picker"),i.style.position="absolute",i.style.bottom="50px",i.style.left="10px",i.style.zIndex="1000";const y=["üòÄ","üòÅ","üòÇ","ü§£","üòÉ","üòÑ","üòÖ","üòÜ","üòâ","üòä","üòç","üòò","üòú","üòé","üò≠","üò°","üòá","üòà","üôÉ","ü§î","üò•","üòì","ü§©","ü•≥","ü§Ø","ü§¨","ü§°","üëª","üíÄ","üëΩ","ü§ñ","üéÉ","üê±","üê∂","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","ü¶Å","üêÆ","üê∑","üê∏","üêµ","üêî","üêß","üê¶","üåπ","üåª","üå∫","üå∑","üåº","üçé","üçì","üçí","üçá","üçâ","üçã","üçä","üçå","ü•ù","üçç","ü•≠"];let C="";y.forEach(d=>{C+=`<span class="emoji-item">${d}</span>`}),i.innerHTML=C,i.addEventListener("click",d=>{if(d.target.classList.contains("emoji-item")){const g=d.target.textContent,h=c.selectionStart,w=c.value.substring(0,h),m=c.value.substring(h);c.value=w+g+m;const f=h+g.length;c.selectionStart=f,c.selectionEnd=f,c.focus()}}),u.appendChild(r),u.appendChild(i),i.style.display="none",r.addEventListener("click",d=>{d.stopPropagation(),i.style.display=i.style.display==="none"?"flex":"none"}),document.addEventListener("click",d=>{!i.contains(d.target)&&!r.contains(d.target)&&(i.style.display="none")})}document.addEventListener("DOMContentLoaded",()=>{var E,M,I;let c=document.querySelector(".chat-container")||document.getElementById("chat-container");!c||!c.dataset.chatId||!c.dataset.chatType?(console.warn("Chat container –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–∞—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é."),window.currentChatId="0",window.currentChatType="group"):(window.currentChatId=c.dataset.chatId,window.currentChatType=c.dataset.chatType),(M=(E=window.Laravel)==null?void 0:E.user)==null||M.id;const u=(I=document.querySelector('meta[name="csrf-token"]'))==null?void 0:I.getAttribute("content");let r=new Set;window.loadedMessageIds=r,window.lastLoadedMessageId=0,window.fetchNewMessages=T;function i(e){if(!window.firestore)return;const s=window.firestore.collection?window.firestore.collection(`chats/${e}/messages`):null;if(!s)return;s.orderBy("created_at").onSnapshot(a=>{let t=[];a.docChanges().forEach(n=>{if(n.type==="added"){const o=n.doc.data();r.has(o.id)||t.push(o)}}),t.length>0&&(v(t,window.Laravel.user.id,r,u,currentChatType,currentChatId),g(currentChatId,currentChatType))},a=>{console.error("–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ Firestore –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:",a)})}async function y(e,s){window.currentChatId=e,window.currentChatType=s,window.lastLoadedMessageId=0;const a=document.getElementById("chat-messages").querySelector("ul");a.innerHTML="",r.clear();const t=document.querySelector(`[data-chat-id="${e}"][data-chat-type="${s}"] h5`);document.getElementById("chat-header").textContent=t?t.textContent:"–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è";try{const n=await fetch(`/chats/${s}/${e}/messages`);if(!n.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–æ–±—â–µ–Ω–∏–π.");const o=await n.json();o.error?h(o.error):(o.messages&&o.messages.length>0&&(window.lastLoadedMessageId=o.messages[o.messages.length-1].id,v(o.messages,window.Laravel.user.id,r,u,s,e)),await g(e,s),i(e),T())}catch(n){h("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π: "+n.message),console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:",n)}}(()=>{const e=document.querySelectorAll(".attach-file"),s=document.querySelectorAll(".file-input");e.forEach((l,a)=>{s[a]&&(l.addEventListener("click",()=>{s[a].click()}),s[a].addEventListener("change",t=>{t.target.files.length>0&&(console.log("–í—ã–±—Ä–∞–Ω—ã —Ñ–∞–π–ª—ã, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ"),d())}))})})();async function d(){if(!currentChatId||!f.value.trim()&&!document.querySelector(".file-input").files.length)return;m.disabled=!0;const e=f.value.trim(),l=document.querySelector(".file-input").files,a=new FormData;if(a.append("message",e),l&&l.length>0)for(let t=0;t<l.length;t++)a.append("attachments[]",l[t]);try{const t=await fetch(`/chats/${currentChatType}/${currentChatId}/messages`,{method:"POST",headers:{"X-CSRF-TOKEN":u},body:a});if(!t.ok){const o=await t.text();throw new Error(o)}const n=await t.json();if(n.message){v([n.message],n.message.sender_id,r,u,currentChatType,currentChatId),window.lastLoadedMessageId=n.message.id,f.value="",document.querySelector(".file-input").value="";const o=document.querySelector(".file-preview");o&&(o.innerHTML="",o.style.display="none")}else h(n.error||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è")}catch(t){h("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: "+t.message),console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:",t)}finally{m.disabled=!1}}function g(e,s){fetch(`/chats/${s}/${e}/mark-read`,{method:"POST",headers:{"X-CSRF-TOKEN":u}}).catch(l=>console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–º–µ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö:",l))}function h(e){console.log("Toast message:",e)}const w=document.getElementById("chat-list");w&&w.addEventListener("click",e=>{const s=e.target.closest("li");if(!s)return;const l=s.getAttribute("data-chat-id"),a=s.getAttribute("data-chat-type");if(!(currentChatId===l&&currentChatType===a)&&(y(l,a),window.innerWidth<=768)){const t=document.querySelector(".user-list"),n=document.querySelector(".chat-box");t&&n&&(t.classList.remove("active"),n.classList.add("active"),t.classList.add("inactive"),n.classList.add("active"))}});const m=document.getElementById("send-message"),f=document.getElementById("chat-message");b(f),m&&m.addEventListener("click",d),f&&f.addEventListener("keypress",e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),d())});const L=document.getElementById("toggle-pinned");let p=!1;L&&L.addEventListener("click",function(){p=!p,k(p),L.textContent=p?"–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è":"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ"});function S(){let e=setInterval(()=>{try{window.fetchNewMessages&&typeof window.fetchNewMessages=="function"&&window.fetchNewMessages()}catch(s){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —á–∞—Ç–∞:",s)}},1e3);window.chatUpdateTimer=e,window.fetchNewMessages&&window.fetchNewMessages()}S()});
