import{r as g}from"./notification-pIEpekV4.js";import"./firebase-init-B7bxRSzu.js";import"./index.esm2017-VEW1WqW1.js";document.addEventListener("DOMContentLoaded",()=>{window.lastLoadedMessageId=0;let l=null,u=null;window.Laravel.user.id;const c=document.querySelector('meta[name="csrf-token"]').getAttribute("content");function m(e,t){fetch(`/chats/${t}/${e}/mark-read`,{method:"POST",headers:{"X-CSRF-TOKEN":c}}).catch(a=>console.error("Ошибка при пометке сообщений как прочитанных:",a))}function i(e,t="error"){console.log(`[${t.toUpperCase()}] ${e}`)}async function h(e,t){window.lastLoadedMessageId=0;const n=document.getElementById("chat-messages").querySelector("ul");n.innerHTML="";const r=document.querySelector(`[data-chat-id="${e}"][data-chat-type="${t}"] h5`);document.getElementById("chat-header").textContent=r?r.textContent:"Выберите чат для общения";try{const s=await fetch(`/chats/${t}/${e}/messages`);if(!s.ok)throw new Error("Ошибка запроса сообщений.");const o=await s.json();o.error?i(o.error):(o.messages&&o.messages.length>0&&(window.lastLoadedMessageId=o.messages[o.messages.length-1].id),g(o.messages,window.Laravel.user.id,new Set,c,t,e)),await m(e,t)}catch(s){i("Ошибка загрузки сообщений: "+s.message),console.error("Ошибка загрузки сообщений:",s)}}if(window.innerWidth<=768){const e=document.createElement("div");e.className="burger-menu",e.innerHTML=`
            <div class="burger-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
        `;const t=document.querySelector(".chat-header");if(t){t.appendChild(e);const a=document.querySelector(".user-list"),n=document.querySelector(".chat-box");a&&n&&e.addEventListener("click",()=>{a.classList.toggle("active"),n.classList.toggle("inactive")})}}const d=document.getElementById("chat-list");d&&d.addEventListener("click",e=>{const t=e.target.closest("li");if(!t)return;const a=t.getAttribute("data-chat-id"),n=t.getAttribute("data-chat-type");if(!(l===a&&u===n)&&(h(a,n),window.innerWidth<=768)){const r=document.querySelector(".user-list"),s=document.querySelector(".chat-box");r&&s&&(r.classList.remove("active"),s.classList.remove("inactive"),r.classList.add("inactive"),s.classList.add("active"))}})});
